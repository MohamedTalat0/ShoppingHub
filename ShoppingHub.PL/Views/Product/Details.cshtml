@* @ *@@* model ShoppingHub.BLL.ModelVm.ProductDetailsVM

@{
    ViewData["Title"] = "Product Details";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
    var isRtl = System.Threading.Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName == "ar";
}

<div class="container my-5">
    <!-- Product Card -->
    <div class="row shadow-lg mx-auto"
         style="max-width: 1200px;
                border-radius: 16px;
                background: linear-gradient(135deg, #4a148c 30%, #1565c0 100%);
                color: white;
                padding: 40px;">

        <!-- Product Image -->
        <div class="col-md-6 text-center d-flex align-items-center justify-content-center">
            <div class="bg-white rounded shadow-sm p-4"
                 style="width: 100%; max-height: 600px;">
                <img src="@Url.Content(Model.ImagePath)"
                     class="img-fluid"
                     alt="@Model.ProductName"
                     style="object-fit: contain; max-height: 550px; width: auto;" />
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-md-6 d-flex flex-column justify-content-center ps-5">
            <!-- Product Name -->
            <!-- Product Name -->
            <h1 class="fw-bold mb-4"
                style="font-size: 3rem; color: #ffe600; line-height: 1.2; text-align:@(isRtl ? "right" : "left");">
                @(isRtl ? Model.ProductNameAR : Model.ProductName)
            </h1>

          
            <!-- Price -->
            <h2 class="fw-bold mb-4" style="color: #00ff99; font-size: 2.5rem;">
                $@Model.Price
            </h2>

            <!-- Product Description -->
            <p style="line-height: 1.8; font-size: 1.2rem; color: #f1f1f1; text-align:@(isRtl ? "right" : "left");">
                @(isRtl ? Model.DescriptionAR : Model.Description)
            </p>
          

            <!-- Action Buttons -->
            <div class="mt-5 d-flex flex-wrap gap-4">
                <a href="#" class="btn btn-lg shadow px-5 py-3"
                   style="background: #ffe600; color: #222; font-weight: bold; border-radius: 10px; font-size: 1.2rem;">
                    <i class="bi bi-cart-plus"></i> Add to Cart
                </a>
                <a asp-action="GetAllProducts" class="btn btn-outline-light btn-lg px-5 py-3"
                   style="border-radius: 10px; font-size: 1.2rem;">
                    Back to Products
                </a>
            </div>
        </div>
    </div>
</div> *@

@model ShoppingHub.BLL.ModelVm.ProductDetailsVM

@{
    ViewData["Title"] = "Product Details";
    Layout = "~/Views/Shared/_NewLayout.cshtml";
    var isRtl = System.Threading.Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName == "ar";
}

<div class="container my-5">
    <!-- Product Card -->
    <div class="row shadow-lg mx-auto"
         style="max-width: 1200px;
                border-radius: 16px;
                background: linear-gradient(135deg, #4a148c 30%, #1565c0 100%);
                color: white;
                padding: 40px;">

        <!-- Product Image -->
        <div class="col-md-6 text-center d-flex align-items-center justify-content-center">
            <div class="bg-white rounded shadow-sm p-4"
                 style="width: 100%; max-height: 600px;">
                <img src="@Url.Content(Model.ImagePath)"
                     class="img-fluid"
                     alt="@Model.ProductName"
                     style="object-fit: contain; max-height: 550px; width: auto;" />
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-md-6 d-flex flex-column justify-content-center ps-5">
            <!-- Product Name -->
            <h1 class="fw-bold mb-4"
                style="font-size: 3rem; color: #ffe600; line-height: 1.2; text-align:@(isRtl ? "right" : "left");">
                @(isRtl ? Model.ProductNameAR : Model.ProductName)
            </h1>

            <!-- Price -->
            <h2 class="fw-bold mb-4" style="color: #00ff99; font-size: 2.5rem;">
                $@Model.Price
            </h2>

            <!-- Average Rating -->
            <div class="mb-3">
                <strong>Rating:</strong>
                @if (Model.AverageRating.HasValue && Model.AverageRating.Value > 0)
                {
                    <span class="text-warning">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Math.Round(Model.AverageRating.Value))
                            {
                                <i class="bi bi-star-fill"></i>
                            }
                            else
                            {
                                <i class="bi bi-star"></i>
                            }
                        }
                        <span class="ms-2">(@Model.AverageRating.Value.ToString("0.0"))</span>
                    </span>
                }
                else
                {
                    <span class="text-muted">Not rated yet</span>
                }
            </div>


            <!-- Product Description -->
            <p style="line-height: 1.8; font-size: 1.2rem; color: #f1f1f1; text-align:@(isRtl ? "right" : "left");">
                @(isRtl ? Model.DescriptionAR : Model.Description)
            </p>

            <!-- Action Buttons -->
            <div class="mt-5 d-flex flex-wrap gap-4">
                <form asp-action="AddToCart" asp-controller="Cart" method="post">
                    <input type="hidden" name="ProductID" value="@Model.ProductID" />
                    <input type="hidden" name="Quantity" value="1" />
                    <button type="submit" class="btn btn-light btn-sm mt-3 w-100 fw-bold">
                        <i class="bi bi-cart"></i> @SharedLocalizer["Add to Cart"]
                    </button>
                </form>
                <a asp-action="GetAllProducts" class="btn btn-outline-light btn-lg px-5 py-3"
                   style="border-radius: 10px; font-size: 1.2rem;">
                    @SharedLocalizer["Back to Products"]
                </a>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header bg-secondary text-white">
            Customer Reviews
        </div>
        <div class="card-body">
            @if (Model.Ratings != null && Model.Ratings.Any())
            {
                @foreach (var r in Model.Ratings)
                {
                    <div class="mb-3 border-bottom pb-2">
                        <strong>@r.UserName</strong>
                        <span class="text-warning">
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= r.Rate)
                                {
                                    <i class="bi bi-star-fill"></i>
                                }
                                else
                                {
                                    <i class="bi bi-star"></i>
                                }
                            }
                        </span>
                        <p class="mt-1">@r.Comment</p>
                    </div>
                }
            }
            else
            {
                <p class="text-muted">No reviews yet.</p>
            }
        </div>
    </div>



  @*   <!-- User Reviews Section -->
    <div class="mt-5 p-4 rounded shadow-lg"
         style="background: linear-gradient(135deg, #1565c0 30%, #4a148c 100%); color: white;">
        <h3 class="mb-4 fw-bold">
            @SharedLocalizer["User Reviews"]
        </h3>

        @if (Model.Ratings != null && Model.Ratings.Any())
        {
            foreach (var r in Model.Ratings)
            {
                <div class="border-bottom pb-3 mb-3">
                    <strong>@r.UserName</strong>
                    <span class="ms-2 text-warning">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= r.Rate)
                            {
                                <i class="bi bi-star-fill"></i>
                            }
                            else
                            {
                                <i class="bi bi-star"></i>
                            }
                        }
                    </span>
                    <p class="mt-2">@r.Comment</p>
                </div>
            }
        }
        else
        {
            <p>@SharedLocalizer["No reviews yet. Be the first to rate this product!"]</p>
        } *@
    @if (Model.CanRate)
    {
        <!-- Rating form -->
        <div class="card mt-4">
            <div class="card-header bg-primary text-white">
                Rate this Product
            </div>
            <div class="card-body">
                
                    <form asp-action="RateProduct" method="post">
                        <input type="hidden" name="productId" value="@Model.id" />

                        <!-- Numeric Rating -->
                        <div class="mb-3">
                            <label for="rate" class="form-label">Your Rating (1–5)</label>
                            <input type="number" name="rate" min="1" max="5"
                                   class="form-control" required />
                        </div>

                        <!-- Optional Comment -->
                        <div class="mb-3">
                            <label for="comment" class="form-label">Comment</label>
                            <textarea name="comment" rows="3" class="form-control"></textarea>
                        </div>

                        <button type="submit" class="btn btn-success">Submit Rating</button>
                    </form>
                
            </div>
        </div>
    }

    </div>
</div>

